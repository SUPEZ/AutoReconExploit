import sys
import os
import nmap

ipTarget = 0
rangePorts = 0


def recon():
    try:
        nm = nmap.PortScanner()
        nm.scan(ipTarget, rangePorts)
    except nmap.PortScannerError:
        print('Nmap not found', sys.exc_info()[0])
    except:
        print("Unexpected error:", sys.exc_info()[0])
        sys.exit(0)

    for host in nm.all_hosts():
        print("---------" * 6)
        print("     Host: %s (%s)" % (host, ipTarget))
        print("     State: %s" % nm[host].state())
        mac = nm[host]['addresses']['mac']
        if mac:
            print("     Mac: %s" % nm[host]['vendor'][mac])
            print("     Machine type: %s" % nm[host]['vendor'][mac])
        print("---------" * 6)
        for proto in nm[host].all_protocols():
            print("+++++++++" * 6)
            print("     protocol : %s" % proto)
            ports = nm[host][proto].keys()
            for port in ports:
                print("     Port : %s\tState : %s\tService : %s" % (
                    port, nm[host][proto][port]['state'], nm[host][proto][port]['name']))
                os.system("searchsploit " + proto + " " + nm[host][proto][port]['name'])
            print("---------" * 6)


def main():
    global ipTarget, rangePorts
    # Get command arguments.
    if len(sys.argv) != 3:
        print("./AutoExploit.py <<IP ADDRESS>> <<PORT RANGE>>")
        sys.exit(0)

    ipTarget = sys.argv[1]
    rangePorts = sys.argv[2]

    print("---------" * 6)
    print("     SCANNING THE TARGET " + ipTarget)
    print("---------" * 6)
    recon()


if __name__ == "__main__":
    sys.exit(main())
